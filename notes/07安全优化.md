

秒杀接口的隐藏

使用复杂验证码，考虑OCR识别技术

接口防刷：每个用户在m分钟最多能刷新n次

---



### 接口隐藏

思路：秒杀接口不进行暴露，向用户暴露获取秒杀接口的接口 `/seckill/path` ，需要用户主动获取，**秒杀接口个性化**，在秒杀前需要请求获取自己的秒杀接口 `/seckill/sadglajkgalsglasjoi/doSeckill3`



后端两个接口：

```java
/**
 * 创建秒杀接口
 *
 * @param user    用户信息
 * @param goodsId 商品信息
 * @return 用户 user 对于商品 goodsId 的秒杀路径，具有时效性
 */
@Override
public String createPath(User user, Long goodsId) {

    if (null == goodsId) throw new GlobalException(RespTypeEnum.GOODS_NOT_EXIST);

    String path = null;

    ValueOperations opsFV = redisTemplate.opsForValue();
    if (redisTemplate.hasKey("seckillPath:uid-" + user.getId() + ":gid-" + goodsId)) {
        path = (String) opsFV.get("seckillPath:uid-" + user.getId() + ":gid-" + goodsId);
    }
    if (null == path) {
        String uuid = UUIDUtil.uuid();
        path = MD5Util.md5(uuid + SEKILL_PATH_KEY);
        opsFV.set("seckillPath:uid-" + user.getId() + ":gid-" + goodsId, path,
                60, TimeUnit.SECONDS);
    }

    return path;
}

/**
 * 检查秒杀接口
 *
 * @param user    非null
 * @param goodsId 非null
 * @param path    非null
 * @return
 */
@Override
public Boolean checkPath(User user, Long goodsId, String path) {

    String pathFromRedis =
            (String) redisTemplate.opsForValue().get("seckillPath:uid-" + user.getId() + ":gid-" + goodsId);

    if (pathFromRedis == null) {
        return false;
    }

    return path.equals(pathFromRedis);
}
```

前端

```js
function getSeckillPath() {
    var goodsId = g_getQueryString("goodsId");
    //获取秒杀接口
    $.ajax({
        url: "/seckill/path",
        type: "POST",
        data: {
            "goodsId": goodsId
        },
        success: function (data) {
            if (data.code == 200) {
                doSeckill(goodsId, data.data)//获取秒杀路径后进行秒杀
            } else {
                layer.msg(data.msg)
            }
        },
        error: function () {
            layer.msg("秒杀失败~")
        }
    })
}
```

存在问题：外部人员 获取到后端的 path，并且直到拼接规则，可以获取真正的秒杀路径，还可能会有问题



### 使用验证码

OCR技术成熟，一般的数字、字母验证码可能会被电脑识别，需要使用 数学题、成语题来防范













